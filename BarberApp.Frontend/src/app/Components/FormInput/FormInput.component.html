<form #genericForm="ngForm"
class="input_container w_100 card border p-3 gap-2 shadow-sm"
(ngSubmit)="onSubmit(genericForm)">

  <ng-container *ngIf="formTitle">
    <h2
    [class.d-md-none]="titleOnMobileOnly"
    class="mb-2">{{formTitle}}</h2>
  </ng-container>
  <ng-container *ngFor="let item of inputs; let i = index">

    <div *ngIf="item.type === 'radio'" class="form_group" [class.form_invalid]="getValidationMessage(item) != null">
      <label class="group_title" [class.collapsed]="!formGroup.checked">
        {{item.label}}
        <div class="active_radio">{{item.value}}</div>
        <input type="checkbox" #formGroup (change)="true">
      </label>
      <div class="collapse_group shadow-sm" [class.collapsed]="!formGroup.checked">
        <div class="group_item radio_item" *ngFor="let option of item.formOptions; let i = index" [class.selected]="item.value == option.value">
          <label>
            <input type="radio"
                  id="{{item.id}}_{{option.id}}"
                  name="{{item.id}}"
                  [value]="option.value"
                  [(ngModel)]="item.value"
                  [required]="item.options?.required !== false">
            <div class="label_string">
              <ng-container *ngIf="isArray(option.label)">
                <span *ngFor="let item of getArrayElements(option.label)">
                  {{item}}
                </span>
              </ng-container>
              <ng-container *ngIf="!isArray(option.label)">
                {{option.label}}
              </ng-container>
            </div>
          </label>
        </div>
      </div>
    </div>

    <div *ngIf="item.type === 'simple-radio'"
    [class.disabled]="item.disabled === true"
    class="form_group label py-2">
      {{item.label}}
      <ng-container *ngFor="let option of item.formOptions; let i =  index">
        <ng-container *ngIf="item.disabled === true">
          <label
          style="pointer-events: none;"
          class="border-0 shadow-none disabled">
              <input
              type="radio"
              class="d-block w-auto me-2"
              [name]="option.id" [id]="option.id" [value]="option.value" [(ngModel)]="item.value"
              >
            {{option.label}}
          </label>
        </ng-container>
        <ng-container *ngIf="!item.disabled">
          <label
          class="border-0 shadow-none">
              <input
              type="radio"
              class="d-block w-auto me-2"
              [name]="option.id" [id]="option.id" [value]="option.value" [(ngModel)]="item.value"
              >
            {{option.label}}
          </label>
        </ng-container>
      </ng-container>
    </div>

    <label *ngIf="item.type === 'select'"
    [class.dirty]="item.value !== '' && item.value !== undefined"
    [class.form_invalid]="getValidationMessage(item) != null">
      <select
      class="form-select"
      name="{{item.id}}"
      [value]="item.value"
      [disabled]="item.disabled === true"
      [(ngModel)]="item.value">
        <option *ngFor="let option of item.formOptions; let i = index"
        [value]="option.value">
          <ng-container *ngIf="isArray(option.label)">
            {{item}}
          </ng-container>
          <ng-container *ngIf="!isArray(option.label)">
            {{option.label}}
          </ng-container>
        </option>
      </select>
      <div class="placeholder_title">{{item.label}}</div>
    </label>

    <ng-container *ngIf="item.type === 'checkbox'">

      <div class="p-0 rounded border" [class.form_invalid]="getValidationMessage(item) != null">

        <accordion [isAnimated]="true" class="rounded shadow-sm overflow-hidden">
          <accordion-group
          panelClass="custom-accordion-panel"
          [isDisabled]="item.disabled === true"
          (isOpenChange)="$event? groupToggle.classList.add('expanded') : groupToggle.classList.remove('expanded')">
            <div class="group-header py-2 bg-body position-relative" accordion-heading
            [class.disabled]="item.disabled === true"
             >
              <div class="placeholder_title" [class.active]="getSelectedCheckboxes(item).length > 0">
                {{item.label}}
              </div>
              <div class="group-header-content d-flex">
                <span class="me-3">
                  <ng-container *ngFor="let service of getSelectedNames(item); let i = index">
                    {{service + (i < getSelectedNames(item).length -1? ', ' : '')}}
                  </ng-container>
                </span>
                <div class="group-toggle ms-auto" #groupToggle>
                  <i class="fa-solid fa-chevron-down"></i>
                </div>
              </div>
            </div>
            <hr class="border-top opacity-100">
            <div class="group-options pt-3 overflow-auto"
            style="max-height: 400px;">
              <div class="group_item" *ngFor="let option of item.formOptions; let i = index" [class.selected]="option.isSelected">
                <label class="align-items-center border border-1">
                  <input type="checkbox"
                        id="{{item.id}}_{{i}}"
                        [value]="option"
                        (change)="checkboxElement(item)"
                        [(ngModel)]="option.isSelected"
                        [ngModelOptions]="{standalone: true}"
                        >
                  <div class="label_string">
                    <ng-container *ngIf="isArray(option.label)">
                      <span *ngFor="let item of getArrayElements(option.label)">
                        {{item}}
                      </span>
                    </ng-container>
                    <ng-container *ngIf="!isArray(option.label)">
                      {{option.label}}
                    </ng-container>
                  </div>
                </label>
              </div>
            </div>
            <ng-container *ngIf="item.options?.showTotal">
              <div class="group-total border-top p-3 d-flex justify-content-between">
                <span>Total: </span>
                <span class="fw-semibold">{{getTotalValue(item)}}</span>
              </div>
            </ng-container>
          </accordion-group>
        </accordion>
      </div>

    </ng-container>

    <ng-container *ngIf="item.type  === 'textarea'">
      <label #textAreaLabel [class.dirty]="item.value != ''">
        <textarea
        style="resize: none; outline: none; height: 250px; border-radius: inherit;"
        class="border-0"
        id="{{item.id}}"
        name="{{item.id}}"
        [(ngModel)]="item.value"
        [required]="item.options?.required !== false"
        [disabled]="item.disabled === true"
        (focus)="textAreaLabel.classList.add('dirty')"
        (blur)="item.value === ''? textAreaLabel.classList.remove('dirty') : textAreaLabel.classList.add('dirty')"
        ></textarea>
        <div class="placeholder_title">
          {{item.label}}
        </div>
      </label>
    </ng-container>

    <ng-container
    *ngIf="item.type != 'radio' &&
           item.type != 'checkbox' &&
           item.type != 'simple-radio' &&
           item.type != 'textarea' &&
           item.type != 'select'">
      <label #genericInputLabel [class.dirty]="item.value != ''" [class.focused]="">


        <input *ngIf="item.currency != true && item.options?.mask === undefined"
        [class.form_invalid]="getValidationMessage(item) != null"
        type="{{item.type}}"
        id="{{item.id}}"
        name="{{item.id}}"
        [min]="item.options?.min"
        [max]="item.options?.max"
        [(ngModel)]="item.value"
        [class.password-input]="item.type == 'password'"
        [disabled]="item.disabled === true"
        (ngModelChange)="onChangeOfInput($event, item.options)"
        [required]="item.options?.required !== false">

        <input *ngIf="item.currency != true && item.options?.mask !== undefined"
        [class.form_invalid]="getValidationMessage(item) != null"

        type="{{item.type}}"
        id="{{item.id}}"
        name="{{item.id}}"
        [min]="item.options?.min"
        [max]="item.options?.max"
        [(ngModel)]="item.value"
        [mask]="formMask(item.options?.mask!, item.options?.max)"
        [showMaskTyped]="true"
        [class.password-input]="item.type == 'password'"
        [disabled]="item.disabled === true"
        (ngModelChange)="onChangeOfInput($event, item.options)"
        [required]="item.options?.required !== false">

        <input *ngIf="item.currency"
        [class.form_invalid]="getValidationMessage(item) != null"
        type="{{item.type}}"
        id="{{item.id}}"
        name="{{item.id}}"
        [(ngModel)]="item.value"
        currencyMask [options]="{
          prefix: 'R$ ',
          thousands: '.',
          decimal: ',' ,
          align: 'left',
          allowNegative: false
        }"
        appCurrencyCursor
        [disabled]="item.disabled === true"
        [required]="item.options?.required !== false">


        <div class="placeholder_title">
          {{item.label}}
        </div>
        <button type="button"
        *ngIf="item.type == 'password'"
        class="show_password"
        (pointerenter)="showPassword(item.id)"
        (pointerleave)="showPassword(item.id)">
          <i class="fa-solid show"
          [ngClass]="isShowPassword(item.id)? ' fa-eye':' fa-eye-slash'"></i>
        </button>
      </label>
    </ng-container>

    <div class="alert validation-alert" *ngIf="getValidationMessage(item) != null" >
      {{getValidationMessage(item)}}
    </div>
    <div class="alert" *ngIf="item.alert" >

      {{item.alert}}
    </div>
  </ng-container>

  <div
  [class.me-auto]="marginOnSubmit"
  class="form-footer d-flex justify-content-between w-100 gap-3">

  <ng-container
  *ngIf="extraBtnLeft">
    <button
    (click)="extraBtnLeft.onClick()"
    style="max-width: 50%;"
    class="btn btn-main mt-auto px-4 btn_submit shadow-sm flex-shrink-1" type="button">
      {{extraBtnLeft.label}}
    </button>
  </ng-container>

    <button
    class="btn btn-main mt-auto px-5 btn_submit shadow-sm" type="submit">
      {{submitText}}
    </button>

    <ng-container
    *ngIf="extraBtnRight">
      <button
      (click)="extraBtnRight.onClick()"
      style="max-width: 50%;"
      class="btn btn-main mt-auto px-4 btn_submit shadow-sm flex-shrink-1" type="button">
        {{extraBtnRight.label}}
      </button>
    </ng-container>

  </div>

</form>
