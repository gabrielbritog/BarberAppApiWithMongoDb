<form #genericForm="ngForm"
class="input_container w_100 card border p-2 p-md-3 gap-2 shadow-sm"
(ngSubmit)="onSubmit(genericForm)">

  <ng-container *ngFor="let item of inputs; let i = index">

    <div *ngIf="item.type === 'radio'" class="form_group" [class.form_invalid]="getValidationMessage(item) != null">
      <label class="group_title" [class.collapsed]="!formGroup.checked">
        {{item.label}}
        <div class="active_radio">{{item.value}}</div>
        <input type="checkbox" #formGroup (change)="true">
      </label>
      <div class="collapse_group shadow-sm" [class.collapsed]="!formGroup.checked">
        <div class="group_item radio_item" *ngFor="let option of item.formOptions; let i = index" [class.selected]="item.value == option.value">
          <label>
            <input type="radio"
                  id="{{item.id}}_{{option.id}}"
                  name="{{item.id}}"
                  [value]="option.value"
                  [(ngModel)]="item.value"
                  required>
            <div class="label_string">
              <ng-container *ngIf="isArray(option.label)">
                <span *ngFor="let item of getArrayElements(option.label)">
                  {{item}}
                </span>
              </ng-container>
              <ng-container *ngIf="!isArray(option.label)">
                {{option.label}}
              </ng-container>
            </div>
          </label>
        </div>
      </div>
    </div>

    <label
    *ngIf="item.type === 'select'"
    [class.dirty]="item.value !== '' && item.value !== undefined"
    [class.form_invalid]="getValidationMessage(item) != null">
      <select
      class="form-select"
      name="{{item.id}}"
      [value]="item.value"
      [(ngModel)]="item.value">
        <option *ngFor="let option of item.formOptions; let i = index"
        [value]="option.value"
        required>
          <ng-container *ngIf="isArray(option.label)">
            {{item}}
          </ng-container>
          <ng-container *ngIf="!isArray(option.label)">
            {{option.label}}
          </ng-container>
        </option>
      </select>
      <div class="placeholder_title">{{item.label}}</div>
    </label>

    <ng-container *ngIf="item.type === 'checkbox'">

      <div class="p-0 border-radius-global border" [class.form_invalid]="getValidationMessage(item) != null">

        <accordion [isAnimated]="true" class="border-radius-global shadow-sm overflow-hidden">
          <accordion-group panelClass="custom-accordion-panel"
          (isOpenChange)="$event? groupToggle.classList.add('expanded') : groupToggle.classList.remove('expanded')">
            <div class="group-header py-2 bg-body position-relative" accordion-heading >
              <div class="placeholder_title" [class.active]="getSelectedCheckboxes(item).length > 0">
                {{item.label}}
              </div>
              <div class="group-header-content d-flex">
                <span class="me-3">
                  <ng-container *ngFor="let service of getSelectedNames(item); let i = index">
                    {{service + (i < getSelectedNames(item).length -1? ', ' : '')}}
                  </ng-container>
                </span>
                <div class="group-toggle ms-auto" #groupToggle>
                  <i class="fa-solid fa-chevron-down"></i>
                </div>
              </div>
            </div>
            <hr class="border-top opacity-100">
            <div class="group-options pt-3 overflow-auto"
            style="max-height: 400px;">
              <div class="group_item" *ngFor="let option of item.formOptions; let i = index" [class.selected]="option.isSelected">
                <label class="align-items-center border border-1">
                  <input type="checkbox"
                        id="{{item.id}}_{{i}}"
                        [value]="option"
                        (change)="checkboxElement(item)"
                        [(ngModel)]="option.isSelected"
                        [ngModelOptions]="{standalone: true}"
                        >
                  <div class="label_string">
                    <ng-container *ngIf="isArray(option.label)">
                      <span *ngFor="let item of getArrayElements(option.label)">
                        {{item}}
                      </span>
                    </ng-container>
                    <ng-container *ngIf="!isArray(option.label)">
                      {{option.label}}
                    </ng-container>
                  </div>
                </label>
              </div>
            </div>
            <ng-container *ngIf="item.options?.showTotal">
              <div class="group-total border-top p-3 d-flex justify-content-between">
                <span>Total: </span>
                <span class="fw-semibold">{{getTotalValue(item)}}</span>
              </div>
            </ng-container>
          </accordion-group>
        </accordion>
      </div>

    </ng-container>

    <ng-container
    *ngIf="item.type != 'radio' &&
           item.type != 'checkbox' &&
           item.type != 'select'">
      <label #genericInputLabel [class.dirty]="item.value != ''" [class.focused]="">


        <input *ngIf="item.currency != true"
        [class.form_invalid]="getValidationMessage(item) != null"
        type="{{item.type}}"
        id="{{item.id}}"
        name="{{item.id}}"
        [min]="item.options?.min"
        [max]="item.options?.max"
        [(ngModel)]="item.value"
        [class.password-input]="item.type == 'password'"
        required>

        <input *ngIf="item.currency"
        [class.form_invalid]="getValidationMessage(item) != null"
        type="{{item.type}}"
        id="{{item.id}}"
        name="{{item.id}}"
        [(ngModel)]="item.value"
        currencyMask [options]="{
          prefix: 'R$ ',
          thousands: '.',
          decimal: ',' ,
          align: 'left',
          allowNegative: false
        }"
        appCurrencyCursor
        required>


        <div class="placeholder_title">
          {{item.label}}
        </div>
        <button type="button"
        *ngIf="item.type == 'password'"
        class="show_password"
        (pointerenter)="showPassword(item.id)"
        (pointerleave)="showPassword(item.id)">
          <i class="fa-solid show"
          [ngClass]="isShowPassword(item.id)? ' fa-eye':' fa-eye-slash'"></i>
        </button>
      </label>
    </ng-container>

    <div class="alert validation-alert" *ngIf="getValidationMessage(item) != null" >
      {{getValidationMessage(item)}}
    </div>
    <div class="alert" *ngIf="item.alert" >

      {{item.alert}}
    </div>
  </ng-container>

  <button
  [class.me-auto]="marginOnSubmit"
  class="btn btn-main mt-auto px-5 btn_submit shadow-sm" type="submit">
    {{submitText}}
  </button>

</form>
